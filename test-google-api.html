<!DOCTYPE html>
<html>
<head>
    <title>Test Google Maps Geocoding API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #F56B4C;
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background: #F56B4C;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background: #e55a3b;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-left: 4px solid #F56B4C;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
        }
        .error {
            border-left-color: #dc3545;
            background: #fff5f5;
            color: #dc3545;
        }
        .success {
            border-left-color: #28a745;
            background: #f0fff4;
            color: #28a745;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .step {
            background: #fff;
            padding: 15px;
            margin: 10px 0;
            border-left: 3px solid #F56B4C;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è Google Maps API Tester for Tiffsy</h1>

        <div class="info">
            <strong>Purpose:</strong> Test if your Google Maps API key is configured correctly.
            <br><br>
            <strong>Steps:</strong>
            <ol>
                <li>Enter your Google Maps API key below</li>
                <li>Enter test coordinates (Indore: 22.7196, 75.8577)</li>
                <li>Click "Test API"</li>
                <li>Check if you get address details</li>
            </ol>
        </div>

        <label><strong>Google Maps API Key:</strong></label>
        <input type="text" id="apiKey" placeholder="AIzaSy..." value="AIzaSyAKlXJ7qwE67VsYZ9x0Ry_qYWLRY0tiBgg">

        <label><strong>Latitude:</strong></label>
        <input type="text" id="latitude" placeholder="22.7196" value="22.7196">

        <label><strong>Longitude:</strong></label>
        <input type="text" id="longitude" placeholder="75.8577" value="75.8577">

        <button onclick="testAPI()">üß™ Test API</button>
        <button onclick="diagnoseIssues()" style="background: #6c757d; margin-left: 10px;">üîç Diagnose Issues</button>

        <div id="result"></div>

        <div class="step" style="margin-top: 30px;">
            <h3>Common Issues & Solutions:</h3>
            <ul>
                <li><strong>REQUEST_DENIED:</strong> Billing not enabled or API not enabled</li>
                <li><strong>OVER_QUERY_LIMIT:</strong> You've exceeded your quota</li>
                <li><strong>INVALID_REQUEST:</strong> Check your API key format</li>
                <li><strong>ZERO_RESULTS:</strong> No address at this location (try different coordinates)</li>
            </ul>
        </div>
    </div>

    <script>
        async function testAPI() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const lat = document.getElementById('latitude').value.trim();
            const lon = document.getElementById('longitude').value.trim();
            const resultDiv = document.getElementById('result');

            if (!apiKey) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Please enter an API key</div>';
                return;
            }

            if (!lat || !lon) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Please enter latitude and longitude</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="result">‚è≥ Testing API... Please wait...</div>';

            const url = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lon}&key=${apiKey}&language=en`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                console.log('Full API Response:', data);

                if (data.status === 'OK') {
                    const result = data.results[0];
                    const formatted = result.formatted_address;

                    let output = '‚úÖ SUCCESS! Your API key is working!\n\n';
                    output += 'üìç Location: ' + formatted + '\n\n';
                    output += 'üè† Address Components:\n';

                    result.address_components.forEach(component => {
                        output += `  ‚Ä¢ ${component.types[0]}: ${component.long_name}\n`;
                    });

                    output += '\n‚úì Your API is properly configured!';
                    output += '\n‚úì You can use this key in your app';

                    resultDiv.innerHTML = '<div class="result success">' + output + '</div>';
                } else if (data.status === 'REQUEST_DENIED') {
                    let output = '‚ùå REQUEST DENIED\n\n';
                    output += 'Possible causes:\n';
                    output += '1. Billing is not enabled in Google Cloud Console\n';
                    output += '2. Geocoding API is not enabled\n';
                    output += '3. API key restrictions are too strict\n\n';
                    output += 'Error message: ' + (data.error_message || 'No error message provided');

                    resultDiv.innerHTML = '<div class="result error">' + output + '</div>';
                } else if (data.status === 'OVER_QUERY_LIMIT') {
                    let output = '‚ùå OVER QUERY LIMIT\n\n';
                    output += 'You have exceeded your API quota.\n';
                    output += 'Solutions:\n';
                    output += '1. Wait until your quota resets (next billing cycle)\n';
                    output += '2. Enable billing if not enabled\n';
                    output += '3. Increase your quota limit';

                    resultDiv.innerHTML = '<div class="result error">' + output + '</div>';
                } else if (data.status === 'ZERO_RESULTS') {
                    let output = '‚ö†Ô∏è ZERO RESULTS\n\n';
                    output += 'API is working but no address found at these coordinates.\n';
                    output += 'Try different coordinates (e.g., 22.7196, 75.8577 for Indore)';

                    resultDiv.innerHTML = '<div class="result error">' + output + '</div>';
                } else {
                    let output = '‚ùå ERROR: ' + data.status + '\n\n';
                    output += 'Message: ' + (data.error_message || 'Unknown error');

                    resultDiv.innerHTML = '<div class="result error">' + output + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Network Error:\n\n' + error.message + '</div>';
            }
        }

        async function diagnoseIssues() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const resultDiv = document.getElementById('result');

            if (!apiKey) {
                resultDiv.innerHTML = '<div class="result error">‚ùå Please enter an API key first</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="result">üîç Running diagnostics...</div>';

            let diagnostics = 'üî¨ API Diagnostics Report\n\n';

            // Check API key format
            if (apiKey.startsWith('AIza')) {
                diagnostics += '‚úì API key format looks correct\n';
            } else {
                diagnostics += '‚úó API key format seems wrong (should start with AIza)\n';
            }

            diagnostics += '\nüìã To fully diagnose, please check:\n\n';
            diagnostics += '1. Google Cloud Console:\n';
            diagnostics += '   ‚Ä¢ Go to: console.cloud.google.com\n';
            diagnostics += '   ‚Ä¢ Navigate to: APIs & Services ‚Üí Dashboard\n';
            diagnostics += '   ‚Ä¢ Verify "Geocoding API" is ENABLED\n\n';

            diagnostics += '2. Billing:\n';
            diagnostics += '   ‚Ä¢ Go to: Billing section\n';
            diagnostics += '   ‚Ä¢ Ensure billing account is linked\n';
            diagnostics += '   ‚Ä¢ Check if free trial is active\n\n';

            diagnostics += '3. API Key Restrictions:\n';
            diagnostics += '   ‚Ä¢ Go to: Credentials\n';
            diagnostics += '   ‚Ä¢ Click on your API key\n';
            diagnostics += '   ‚Ä¢ Check API restrictions: Should allow "Geocoding API"\n';
            diagnostics += '   ‚Ä¢ Check Application restrictions: Should be "None" for testing\n\n';

            diagnostics += '4. Usage/Quota:\n';
            diagnostics += '   ‚Ä¢ Go to: APIs & Services ‚Üí Geocoding API\n';
            diagnostics += '   ‚Ä¢ Check if you have quota remaining\n';
            diagnostics += '   ‚Ä¢ Free tier: 28,500 requests/month\n\n';

            diagnostics += 'üîß Quick Fixes:\n';
            diagnostics += '‚Ä¢ Try creating a NEW API key\n';
            diagnostics += '‚Ä¢ Disable all restrictions temporarily\n';
            diagnostics += '‚Ä¢ Wait 5 minutes after creating new key\n';
            diagnostics += '‚Ä¢ Check billing is enabled (required even for free tier)\n';

            resultDiv.innerHTML = '<div class="result">' + diagnostics + '</div>';
        }

        // Test with Enter key
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                testAPI();
            }
        });
    </script>
</body>
</html>
